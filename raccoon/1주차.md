### 인터넷 통신

- 클라이언트 ↔ 인터넷 ↔ 서버
- 인터넷 망을 통해서 메세지를 전달

### IP(인터넷 프로토콜)

- IP 주소를 부여받아야 한다. (클라이언트와 서버 모두)
- IP의 역할
    - 지정한 IP 주소에 데이터 전달
    - 패킷이라는 단위로 데이터 전달
- IP 패킷 정보
    - 출발지 IP, 목적지 IP, 데이터 등등등
    - 송신자의 출발지 IP와 수신자의 목적지 IP를 넣어 주고 인터넷 망에 넘겨주면 노드를 거쳐서 서버까지 전달됨
    - 잘 받았으면 수신자가 송신자에게 잘 받았다고 메시지 전달

### IP 프로토콜의 한계

1. 비연결성
    - 패킷을 받을 대상이 없거나 서비스가 불능 상태여도 패킷이 전송된다.
    - 대상 서버가 패킷을 받을 수 있는 상태인지 모른다.
2. 비신뢰성
    - 패킷이 손실되는 문제가 있을 수 있음.
        - 중간에 노드가 꺼지는 경우?
    - 순차적 패킷 전송이 보장되지 않음
        - 패킷이 큰 경우 1500바이트씩 끊어서 전송
        - a를 보내고, b를 보내는 경우 이동하는 노드의 경로가 다를 수 있다.
        - 의도는 a, b 순으로 도착하는 거지만 b, a 순으로 도착할 수 있다.
        - IP 프로토콜만으로는 이를 해결할 수 없음.
3. 프로그램 구분
    - 인터넷을 하면서 음악을 하는 등 같은 IP에서 여러개의 애플리케이션 동작시 구분이 안됨

### TCP와 UDP

- 인터넷 프로토콜 스택의 4계층
    - 애플리케이션 계층 - HTTP, FTP
        
        → 소켓 라이브러리를 통해 hello world!라는 메시지 전달
        
    - 전송 계층 - TCP, UDP
        
        → TCP 정보 생성, 상위 계층의 메시지 데이터 포함
        
    - 인터넷 계층 - IP
        
        → IP 패킷 생성, 상위 계층의 TCP 정보 포함
        
    - 네트워크 인터페이스 계층(랜카드, 랜드라이버 등등)
- TCP가 IP를 보완하는 역할

### IP 패킷

- 출발지 IP, 목적지 IP

### TCP/IP 패킷 정보

- 출발지 Port, 목적지 Port
- 전송 제어, 순서, 검증 정보 등이 들어감
    
    → 앞서 IP의 문제점 해결
    

### TCP 특징

- 전송 제어 프로토콜
1. 연결지향
    - TCP 3-way handshake (가상 연결)
    - 연결을 한 다음 메세지를 보내기 때문에 상대방 컴퓨터가 꺼져있는지 확인할 수 있음
2. 데이터 전달 보증
    - 패킷을 보냈을 때 중간에 누락되었는지 여부를 알 수 있음
3. 순서 보장
4. 신뢰할 수 있는 프로토콜
5. 대부분의 애플리케이션에서 TCP 사용

### TCP 3-way handshake

1. 클라이언트에서 서버로 SYN 메세지 전달(synchronize)
2. 서버가 클라이언트에게 SYN + ACK 메시지 전달
3. 클라이언트가 서버에게 ACK 메세지 전달
    1. 요즘은 마지막 ACK 메세지와 전달하고자 하는 메시지를 같이 전달함
- 물리적으로 연결되는것은 아니고, 개념적으로 연결되었다는 뜻.
    - 나를 위한 전용 랜선이 존재하는건 아니다
- 위 방법으로 연결하면 클라이언트가 서버를 믿을 수 있으며, 서버가 클라이언트를 믿을 수 있음.
- 연결이 맺어진 다음에 데이터 전달

### TCP의 특징

- 데이터 전송 및 데이터 응답 보증
- 도착하는 순서 보장
    - 패킷 1번 이후 2번이 아닌 다른 패킷이 오면 다 버리고 2번부터 다시 보내도록 요청하고 기다림
    - 캐시 등 내부적으로 최적화가 일어날 수도 있다.
- TCP 패킷 정보에 데이터가 있기에 가능하다

### UDP

- 기능이 거의 없음
- 연결지향 X
- 데이터 전달 보증 X
- 순서 보장 X
- 데이터 전달 및 순서가 보장되지 않지만 단순하고 빠름
- IP와 거의 같지만 Port와 체크섬(메시지가 제대로 왔는지 검증) 정도만 추가
    - Port로 인해 하나의 IP에서 여러개의 패킷이 올 때 작업 구분 가능
    - 게임, 음악을 동시에 할때 서로다른 포트 사용
- 애플리케이션에서의 추가 작업 필요

### UDP의 장점

- TCP에 비해 전송 속도가 빠르며 최적화를 할 수가 있다.
    - TCP 프로토콜은 손을 댈 수가 없음.
- TCP는 그대로 사용하고, UDP는 내가 원하는 대로 어플리케이션 레벨에서 만들어 주면 된다.
- http3같은 경우에는 UDP를 사용하여 각광받고 있음.

### Port

- 한번에 둘 이상 연결해야 한다면?
    - 게임, 화상통화, 웹 브라우저 요청 등등등
    - 하나의 클라이언트가 여러개의 서버와 통신해야 한다.
- IP에 더해서 Port
    - IP는 목적지(아파트)
    - Port는 각각의 애플리케이션 구분(각각의 호)
    - 서버가 내 Port를 알 수 있는 이유는 패킷에 출발지 Port도 써준다.
- 0~65535 할당 가능
    - 0~1023: 잘 알려진 포트, 사용하지 않는 것이 좋음
    - FTP는 20, 21
    - TELNET은 23
    - HTTP는 80
    - HTTPS는 443

### DNS

- IP로 통신하기엔 어렵기도 하고 IP가 변경될 수도 있는 문제점이 있음.
- 도메인 네임 시스템(DNS)
    - 전화번호부
    - 도메인 명을 IP주소로 바꿀 수 있음
- DNS 서버에 도메인 명과 IP 주소를 등록해 두면 DNS 서버가 도메인 이름에 해당하는 IP 주소를 반환
    - IP 주소를 바꾸더라도 도메인 명은 그대로이다.

### URI와 웹 브라우저 요청 흐름

### URI(Uniform Resource Identifier)

- URI vs URL vs URN
- URI는 로케이터, 이름 또는 둘다 추가로 분류될 수 있다.
- URI : 리소스를 식별, URL과 URN의 조합
    - URL : 리소스가 존재하는 위치(경기도 성남시의)
        
        → 위치는 변할 수 있음, 이름은 변하지 않는다.
        
    - URN : 리소스의 이름(라쿤)
        
        → URN 이름만으로 실제 리소스를 찾을 수 있는 방법이 보편화 되지 않음
        
    - 거의 URN은 쓰지 않고, URL만 사용함
- Uniform : 리소스 식별하는 통일된 방식
- Resource: 자원, URI로 식별할 수 있는 모든 것
- Identifier : 다른 항목과 구분하는데 필요한 정보

### URL 분석

- https://google.com/search?q=hello&hl=ko
- 프로토콜(https)
- 호스트명(www.google.com)
- 포트 번호(443)
- 경로 or 패스(/search)
- 쿼리 파라메터(q=hello&hl=ko)

### URL 구성 요소

---

`scheme://[userinfo@]host[:port][/path][?query][#fragment]`

### URL Scheme

---

- 주로 프로토콜 사용
- 프로토콜이란 어떤 방식으로 자원에 접근할 것인가 하는 약속 규칙
    - http, https, ftp 등등
- http는 80, https는 443 포트 주로 사용, 포트는 생략 가능

### userinfo

---

- URL에 사용자정보를 포함해서 인증
- 거의 사용하지 않음.

### host

---

- 호스트명 ⇒ 도메인명 또는 IP주소 직접 사용 가능
    - ex) www.google.com

### port

---

- 포트(PORT), 일반적으로 생략 가능
- 생략 시 http는 80, https는 443 포트 사용

### path

---

- 리소스가 존재하는 경로, 계층적 구조를 가진다.
- /home/file1.jpg
- /members
- /members/100, /items/iphone12

### query

---

- key=value 형태
- ?로 시작, &로 추가 가능
- query parameter, query string으로 불림. 웹서버에 제공하는 파라메터나 문자 형태

### fragment

---

- html 내부 북마크 등에 사용
    - 특정 위치로 로드한다던가 등등
- 서버에 전송하는 부분 아님.

### 주소창에 url을 쳤을때의 동작 과정

---

### https://www.google.com/search?q=hello&hl=ko

1. [www.google.com](http://www.google.com) dns 조회
2. https 포트 생략(443)
3. 웹 브라우저가 http 요청 메시지 생성
    
    get /search?q=hello&hl=ko HTTP/1.1
    
    ...
    
4. Socket 라이브러리를 통해 TCP/IP 연결 후 데이터 전달
5. HTTP 메세지가 포함되어 있는 TCP/IP 패킷 생성
6. 서버에서 메시지를 보고 HTTP 응답 메시지를 생성해서 클라이언트에게 돌려줌
    
    HTTP/1.1 200 OK
    
    1. Content-Type: 응답 데이터의 형식(html 등)
    2. Content-Length : 응답 데이터의 길이
7. 클라이언트가 html 데이터를 받으면 웹 브라우저에서 렌더링을 해준다.

### 꼭 공유하고 싶은 부분(1가지 이상)

---

### TCP 신뢰성 보장 방법

### 신뢰성 보장

- TCP는 오류가 나거나 Timeout이 발생할 경우 재전송하게 된다.
    - 따라서, 수신자가 데이터를 정상적으로 받았으면 ACK, 받았지만 문제가 있는 경우 NAK을 보낸다.
    - 데이터를 정상적으로 받았는지 체크하기 위해 TCP의 CheckSum 필드를 확인하여 손상된 메세지인지 확인 가능
- ACK,NAK 메세지를 보내지 못하면 어떻게?
    - 송신자는 타이머를 가지고 있어서, 타임아웃이 나기 전까지 응답을 받지 못하면 다시 재전송해준다.

### 참고

- [https://wjdtn7823.tistory.com/37](https://wjdtn7823.tistory.com/37)
