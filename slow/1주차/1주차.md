# 네트워크

### **IP (인터넷 프로토콜)**

- IP 주소로 메시지를 전달할 수 있도록 정해놓은 규칙
- IP 역할
    - 지정한 IP 주소(IP Address)에 데이터 전달
    - 패킷(Packet)이라는 통신 단위로 데이터 전달
- IP 패킷 정보
    - 출발지 IP, 목적지 IP, 전송 데이터를 묶은 하나의 블록 단위
- 패킷 전달 방법
    - 클라이언트가 출발지와 도착지의 IP 주소를 넣고 인터넷망에 던지면, 인터넷망의 노드를 거쳐 도착지 서버에 도착하게 된다.
    - 클라이언트의 요청을 받으면, 서버도 똑같은 방법으로 잘받았다는 응답을 던져준다.

### IP 프로토콜의 한계

- 비연결성
    - 패킷을 받을 대상이 없거나 서비스 불능 상태여도 패킷 전송
    - 대상 서버가 패킷을 받을 수 있는 상태인지 모름
- 비신뢰성
    - 중간 노드에 문제가 생기는 등 패킷이 도착하기 전에 소실되도 알 수 없다.
        - ex) 택배를 보냈는데 택배가 물류센터에서 사라짐
    - 패킷이 순서대로 오지 않을 경우
        - hello, world 를 보냈는데, 상대방은 world hello로 받을 수 있다.
- 프로그램 구분
    - 같은 IP를 사용하는 서버에서 통신하는 애플리케이션이 둘 이상인 경우, 구분할 수 없다.
    

### TCP

IP 프로토콜의 문제점을 해결해주는 프로토콜이 TCP 프로토콜이다.

1. 프로그램이 Hello 메시지 생성
2. Socket 라이브러리를 통해서 메시지에다가 TCP 정보를 씌움
3. IP 정보를 또 씌움
4. 정보를 포함한 패킷을 LAN 카드를 통해서 물리적인 정보를 포함하여 인터넷을 통해 서버에 전달


### TCP 특징

전송 제어 프로토콜(Transmission Control Protocol) 

- 연결지향
    - TCP 3way handshake (가상 연결) 방식 제공
- 데이터 전달 보증
    - 서버는 데이터를 받으면, 받았다는 응답을 보낸다.
- 순서 보장
    - 서버에서 잘못 받았다면, 특정 패킷부터 다시 보내라고 클라이언트에게 재요청 한다.
- 신뢰할 수 있는 프로토콜
- 현재 대부분 TCP 사용

### TCP 3way handshake

1. 클라이언트가 서버측에 연결 요청 메시지 전송 (SYN)
    - 송신자가 최초로 데이터를 전송할 때 Sequence Number를 임의의 랜덤 숫자(n)로 지정하고, SYN 플래그 비트를 1로 설정한 세그먼트를 전송한다.
2. 서버는 클라이언트의 요청을 승낙 및 응답 요청 확인 메시지 전송 (ACK, SYN)
3. 클라이언트는 확인 ACK 전달하고 연결. (ACK)
    - 현재는 최적화 되어서 ACK를 보낼 때, 데이터를 함께 전송한다.
    

### UDP 특징

사용자 데이터그램 프로토콜(User Datagram Protocol)

- 비연결형, 단방향으로 데이터를 전송
- 데이터 전달 보증 X
- 순서 보장 X
- 속도가 빠름
- 신뢰성이 중요하지 않은 서비스에 적합
    - 영상 스트리밍, DNS

### PORT

IP

- 목적지 서버를 구분

PORT

- 서버 안에서 애플리케이션 구분
- 같은 IP 내에서 프로세스를 구분

ex)  ㅇㅇ아파트 (IP) 101동 201호(PORT)

- 0~65535 번 까지는 할당이 가능
- 0~1023 번 까지는 잘 알려진 포트들로 사용하지 않는것이 좋습니다.
    - FTP - 20, 21
    - TELNET - 23
    - HTTP - 80
    - HTTPS - 443

### DNS (Domain Name System)

호스트의 도메인 이름을 호스트의 네트워크 주소로 바꾸거나, 그 반대의 변환을 수행는 것을 말한다. (전화번호부)****

- DNS가 필요한 이유
    - IP를 모두 기억하기는 어렵다.
    - IP는 변경될 수 있다.

### URI (Uniform Resource Identifier)

- URI, URL, URN 은 어떻게 구분하나?
    - URI는 로케이터(locator), 이름(name) 또는 둘다 추가로 분류될 수 있다.

- Uniform: 리소스 식별하는 통일된 방식
- Resource: 자원, URI로 식별할 수 있는 모든 것
- Identifier: 다른 항목과 구분하는데 필요한 정보
    
    

### URL

```java
scheme://[userinfo@]host[:port][/path][?query][#fragment]
```

- scheme
    - 주로 프로토콜 사용
    - http는 80포트, https는 443 포트를 주로 사용, 포트는 생략 가능
- userinfo
    - URL에 사용자 정보를 포함해서 인증해야할 때
    - 거의 사용 X
- host
    - 호스트명
    - 도메인명 또는 IP 주소를 직접 사용
- PORT
    - 접속 포트
- path
    - 리소스 경로(path)
    - 계층적 구조
- query
    - key=value 형태
    - ?로 시작, &로 추가 가증
    - 웹서버에 제공하는 파라미터 정보
- fragment
    - html 내부 북마크에서 사용
    - 서버에 전송하는 정보는 아님
    

### 웹 브라우저 요청 흐름

[https://www.google.com/search?q=hello&hl=ko](https://www.google.com/search?q=hello&hl=ko) 요청

1. DNS를 조회해서 구글 서버를 찾는다. 
2. HTTP 요청 메시지를 생성한다.
3. Socket 라이브러리를 통해 TCP/IP 연결 후, 데이터 전달
4. 데이터를 포장해서 TCP/IP 패킷을 생성 후, 패킷 전달
5. 서버에 패킷이 도착하면, 포장된 패킷 껍데기를 벗기고 HTTP 요청 메시지를 해석한다.
6. 응답 메시지를 만들어서 클라이언트에게 전달한다.
7. 클라이언트가 응답 데이터를 받아서 껍데기를 벗기고 html 렌더링을 한다.

### 추가적으로 공유하고 싶은 내용

1. **TCP의 흐름제어와 혼잡제어**
    - 흐름제어
        - 송신하는 곳과 수신하는 곳의 데이터 처리 속도를 조절해서 수신자의 버퍼 오버플로우를 방지하기 위한 방법이다.
        - 사용하는 이유는 송신하는 곳에서 감당이 안되게 데이터를 빠르게 많이 보내면 수신자에서 문제가 발생하기 때문이다.
    - 혼잡제어
        - 네트워크 내의 패킷 수가 넘치게 증가하지 않도록 송신측에서 데이터를 보내는 속도를 제어하는 방법이다.
        - 만약 정보의 소통량이 과다하면 패킷을 조금만 전송하여 혼잡 붕괴 현상이 일어나는 것을 막는다.
2. **TCP 4way handshake**
    - TCP 연결을 해제하는 단계
    
    1. 데이터를 전부 송신한 클라이언트가 서버에게 연결 해제하겠다는 메시지 전송 (FIN)
    2. 서버가 FIN 플래그를 받고, 이를 확인했다는 메시지를 전송(ACK)
    3. 연결을 종료할 준비가 되면, 서버는 클라이언트에게 연결 종료 요청에 합의한다는 의미로 플래그를 전송 (FIN)
    4. 클라이언트는 확인했다는 메시지를 전송(ACK)


1. **만약 Server에서 FIN 세그먼트를 전송하기 전에 전송한 패킷이 Routing 지연이나 패킷 유실로 인한 재전송 등으로 인해 FIN 패킷보다 늦게 도착하는 상황이 발생하면 어떻게 될까?**
- 클라이언트가 세션을 종료시킨 후, 뒤늦게 도착하는 패킷이 있다면 이 패킷은 유실될 것이다.
- 따라서 이러한 현상에 대비하여 클라이언트는 FIN을 수신하더라도 일정시간(디폴트 240초)동안 세션을 남겨놓고 잉여 패킷을 기다리는 과정(TIME_WAIT)을 거친다.
- 일정시간이 지나면, 세션을 만료하고 종료시키며, CLOSE 상태로 변한다.